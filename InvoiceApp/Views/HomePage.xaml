<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="InvoiceApp.Views.HomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ex="using:InvoiceApp.Extensions"
    xmlns:local="using:InvoiceApp.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:service="using:InvoiceApp.Services"
    mc:Ignorable="d"
    >
    <Page.Resources>
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
        </Style>
        <Style x:Key="ExpanderItem" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="0,1,0,0" />
            <Setter Property="Padding" Value="16,8" />
        </Style>
    </Page.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="48" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <!--#region Title bar-->
        <Border
            x:Name="TitleBar"
            Grid.ColumnSpan="2"
            Padding="16,8,0,0"
            >
            <TextBlock Text="Invoice Helper" />
        </Border>
        <!--#endregion-->
        <Grid
            Grid.Row="1"
            Padding="16"
            ColumnSpacing="16"
            RowSpacing="16"
            >
            <Grid.RowDefinitions>
                <RowDefinition MinHeight="200" />
                <RowDefinition Height="auto" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition MinWidth="300" />
                <ColumnDefinition Width="300" />
            </Grid.ColumnDefinitions>
            <!--#region Output-->
            <Expander
                Grid.Row="1"
                Grid.ColumnSpan="2"
                Padding="0"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                VerticalContentAlignment="Stretch"
                IsExpanded="True"
                >
                <Expander.Header>
                    <RelativePanel>
                        <StackPanel
                            Orientation="Horizontal"
                            RelativePanel.AlignVerticalCenterWithPanel="True"
                            Spacing="8"
                            >
                            <FontIcon Glyph="&#xE756;" />
                            <TextBlock Text="控制台输出" />
                        </StackPanel>
                        <Button
                            Command="{x:Bind ViewModel.ClearConsoleCommand}"
                            Content="清除输出"
                            RelativePanel.AlignRightWithPanel="True"
                            />
                    </RelativePanel>
                </Expander.Header>
                <Expander.Content>
                    <ScrollView
                        Height="160"
                        ex:ScrollViewExtension.AutoScrollToEnd="True"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        CornerRadius="0"
                        >
                        <TextBlock
                            Margin="8"
                            HorizontalAlignment="Stretch"
                            FontFamily="Cascadia Mono"
                            FontSize="16"
                            IsTextSelectionEnabled="True"
                            Text="{x:Bind ViewModel.OutString, Mode=OneWay}"
                            TextWrapping="Wrap"
                            />
                    </ScrollView>
                </Expander.Content>
            </Expander>
            <!--#endregion-->
            <!--#region  Right pannel-->
            <ScrollView
                Grid.Column="1"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                >
                <StackPanel Spacing="8">
                    <!--#region Rename-->
                    <Expander
                        Grid.Row="1"
                        Grid.ColumnSpan="2"
                        Padding="0"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Stretch"
                        IsExpanded="True"
                        >
                        <Expander.Header>
                            <RelativePanel>
                                <StackPanel
                                    Orientation="Horizontal"
                                    RelativePanel.AlignVerticalCenterWithPanel="True"
                                    Spacing="8"
                                    >
                                    <FontIcon Glyph="&#xE8AC;" />
                                    <TextBlock Text="自动重命名文件" />
                                </StackPanel>
                                <Button
                                    Command="{x:Bind ViewModel.AutoRenameCommand}"
                                    Content="重命名"
                                    RelativePanel.AlignRightWithPanel="True"
                                    />
                            </RelativePanel>
                        </Expander.Header>
                        <Expander.Content>
                            <StackPanel>
                                <Border BorderThickness="0" Style="{StaticResource ExpanderItem}">
                                    <CheckBox Content="商品名称" IsChecked="{x:Bind ViewModel.IsName, Mode=TwoWay}" />
                                </Border>
                                <Border Style="{StaticResource ExpanderItem}">
                                    <CheckBox Content="总金额" IsChecked="{x:Bind ViewModel.IsAmount, Mode=TwoWay}" />
                                </Border>
                                <Border Style="{StaticResource ExpanderItem}">
                                    <CheckBox Content="发票号码" IsChecked="{x:Bind ViewModel.IsNum, Mode=TwoWay}" />
                                </Border>
                            </StackPanel>
                        </Expander.Content>
                    </Expander>
                    <!--#endregion-->
                    <!--#region Export-->
                    <Expander
                        Grid.Row="1"
                        Grid.ColumnSpan="2"
                        Padding="0"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Stretch"
                        IsExpanded="True"
                        >
                        <Expander.Header>
                            <RelativePanel>
                                <StackPanel
                                    Orientation="Horizontal"
                                    RelativePanel.AlignVerticalCenterWithPanel="True"
                                    Spacing="8"
                                    >
                                    <FontIcon Glyph="&#xE74E;" />
                                    <TextBlock Text="导出数据" />
                                </StackPanel>
                                <ComboBox
                                    Width="120"
                                    RelativePanel.AlignRightWithPanel="True"
                                    RelativePanel.AlignVerticalCenterWithPanel="True"
                                    SelectedIndex="{x:Bind ViewModel.ExportTypeSelectedIndex, Mode=TwoWay}"
                                    >
                                    <x:String>到控制台</x:String>
                                    <x:String>到文本文件</x:String>
                                </ComboBox>
                            </RelativePanel>
                        </Expander.Header>
                        <Expander.Content>
                            <StackPanel>
                                <Border BorderThickness="0" Style="{StaticResource ExpanderItem}">
                                    <RelativePanel>
                                        <TextBlock RelativePanel.AlignVerticalCenterWithPanel="True" Text="出入库信息" />
                                        <Button
                                            Command="{x:Bind ViewModel.ExportLinesCommand}"
                                            Content="导出"
                                            RelativePanel.AlignRightWithPanel="True"
                                            RelativePanel.AlignVerticalCenterWithPanel="True"
                                            />
                                    </RelativePanel>
                                </Border>
                                <Border Style="{StaticResource ExpanderItem}">
                                    <RelativePanel>
                                        <TextBlock RelativePanel.AlignVerticalCenterWithPanel="True" Text="商品名称列表" />
                                        <Button
                                            Command="{x:Bind ViewModel.ExportNamesCommand}"
                                            Content="导出"
                                            RelativePanel.AlignRightWithPanel="True"
                                            RelativePanel.AlignVerticalCenterWithPanel="True"
                                            />
                                    </RelativePanel>
                                </Border>
                                <Border Style="{StaticResource ExpanderItem}">
                                    <RelativePanel>
                                        <TextBlock RelativePanel.AlignVerticalCenterWithPanel="True" Text="发票号码列表" />
                                        <Button
                                            Command="{x:Bind ViewModel.ExportNumbersCommand}"
                                            Content="导出"
                                            RelativePanel.AlignRightWithPanel="True"
                                            RelativePanel.AlignVerticalCenterWithPanel="True"
                                            />
                                    </RelativePanel>
                                </Border>
                            </StackPanel>
                        </Expander.Content>
                    </Expander>
                    <!--#endregion-->
                    <!--#region Info-->
                    <InfoBar
                        Title="页码"
                        IsOpen="True"
                        Message="请将页码设为含有价税合计的那一页（一般是最后一页）。如果解析后信息不全，可能是由此导致"
                        Severity="Informational"
                        />
                    <InfoBar
                        Title="数量"
                        IsOpen="True"
                        Message="当超过一种商品时，将使用第一种商品名称，数量视为一套"
                        Severity="Informational"
                        />
                    <!--#endregion-->
                </StackPanel>
            </ScrollView>
            <!--#endregion-->
            <!--#region Grid-->
            <Expander
                Padding="0"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                VerticalContentAlignment="Stretch"
                IsExpanded="True"
                >
                <Expander.Header>
                    <RelativePanel>
                        <StackPanel
                            Orientation="Horizontal"
                            RelativePanel.AlignVerticalCenterWithPanel="True"
                            Spacing="8"
                            >
                            <FontIcon Glyph="&#xE8A5;" />
                            <TextBlock Text="文件" />
                        </StackPanel>
                        <StackPanel
                            Orientation="Horizontal"
                            RelativePanel.AlignRightWithPanel="True"
                            RelativePanel.AlignVerticalCenterWithPanel="True"
                            Spacing="8"
                            >
                            <Button Command="{x:Bind ViewModel.AddWorkersCommand}" Content="导入发票" />
                            <Button Command="{x:Bind ViewModel.ResolveInvoicesCommand}" Content="解析发票" />
                            <AppBarSeparator Padding="0,4" />
                            <Button Command="{x:Bind ViewModel.ClearWorkersCommand}" Content="清除列表" />
                        </StackPanel>
                    </RelativePanel>
                </Expander.Header>
                <Expander.Content>
                    <Border
                        Grid.Row="1"
                        BorderThickness="0"
                        Style="{StaticResource ExpanderItem}"
                        >
                        <controls:DataGrid
                            Grid.Row="1"
                            d:DataContext="{d:DesignInstance Type=service:ObservableInvoiceWorker}"
                            AutoGenerateColumns="False"
                            GridLinesVisibility="Horizontal"
                            ItemsSource="{x:Bind ViewModel.Workers, Mode=OneWay}"
                            >
                            <controls:DataGrid.Columns>
                                <controls:DataGridTextColumn
                                    Width="200"
                                    Binding="{Binding FileName, Mode=OneWay}"
                                    Header="文件名"
                                    />
                                <controls:DataGridTextColumn Binding="{Binding PageNum, Mode=TwoWay}" Header="页码" />
                                <controls:DataGridTextColumn
                                    Binding="{Binding Number, Mode=OneWay}"
                                    Header="发票号码"
                                    IsReadOnly="True"
                                    />
                                <controls:DataGridTextColumn
                                    Width="200"
                                    Binding="{Binding Name, Mode=OneWay}"
                                    Header="商品名称"
                                    IsReadOnly="True"
                                    />
                                <controls:DataGridTextColumn
                                    Binding="{Binding Unit, Mode=OneWay}"
                                    Header="单位"
                                    IsReadOnly="True"
                                    />
                                <controls:DataGridTextColumn
                                    Binding="{Binding PriceText, Mode=OneWay}"
                                    Header="单价"
                                    IsReadOnly="True"
                                    />
                                <controls:DataGridTextColumn
                                    Binding="{Binding Count, Mode=OneWay}"
                                    Header="数量"
                                    IsReadOnly="True"
                                    />
                                <controls:DataGridTextColumn
                                    Binding="{Binding AmountText, Mode=OneWay}"
                                    Header="价税合计"
                                    IsReadOnly="True"
                                    />
                                <controls:DataGridTextColumn
                                    Width="200"
                                    Binding="{Binding Remarks, Mode=OneWay}"
                                    Header="备注"
                                    IsReadOnly="True"
                                    />
                            </controls:DataGrid.Columns>
                        </controls:DataGrid>
                    </Border>
                </Expander.Content>
            </Expander>
            <!--#endregion-->
        </Grid>
    </Grid>
</Page>
